#SPDX-License-Identifier: MIT-0
---
# tasks file for k8s-cluster

- name: Setting up kernel
  include_tasks: '01-set-kernel.yml'

- name: Installing Container runtime
  include_tasks: '02-install-cri.yml'

- name: Installing Kubetools
  include_tasks: '03-install-kubetools.yml'

- name: Setting up controller
  include_tasks: '04-setup-controller.yml'
  when: 
    - "'k8s_controllers' in group_names"

- name: Initilize cluster on master node
  include_tasks: '05-initialize-cluster.yml'
  when: "'k8s_controllers_master' in group_names"

- name: Copy control join script to control nodes
  copy: 
    src: /tmp/control-join-command.sh 
    dest: /tmp
    mode: '0755'
  when: "'k8s_controllers_slave' in group_names"

- name: Copy worker join script to worker nodes 
  copy: 
    src: /tmp/worker-join-command.sh 
    dest: /tmp 
    mode: '0755'
  when: "'k8s_workers' in group_names"

- name: Join control node into cluster 
  include_tasks: '06-control-join.yml'
  when: "'k8s_controllers_slave' in group_names"